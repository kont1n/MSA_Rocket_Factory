# -----------------------------------------
# ОБЩИЙ ФАЙЛ КОНФИГУРАЦИИ МИКРОСЕРВИСНОЙ АРХИТЕКТУРЫ
# -----------------------------------------
# Этот файл содержит все переменные окружения для всех сервисов
# с префиксами для избежания конфликтов имен.
# -----------------------------------------

# -----------------------------------------
# CORE НАСТРОЙКИ (ОБЩИЕ КОМПОНЕНТЫ)
# -----------------------------------------

# Kafka настройки
CORE_KAFKA_EXTERNAL_PORT=9092
CORE_KAFKA_INTERNAL_PORT=29092
CORE_KAFKA_CONTROLLER_PORT=29093
CORE_KAFKA_UI_PORT=8090

# -----------------------------------------
# IAM СЕРВИС
# -----------------------------------------

# gRPC настройки
IAM_GRPC_HOST=0.0.0.0
IAM_GRPC_PORT=50053
IAM_GRPC_TLS_CERT_FILE=
IAM_GRPC_TLS_KEY_FILE=
IAM_GRPC_INSECURE=true

# Логгер
IAM_LOGGER_LEVEL=info
IAM_LOGGER_AS_JSON=true

# PostgreSQL
IAM_POSTGRES_HOST=postgres-iam
IAM_POSTGRES_PORT=5432
IAM_EXTERNAL_POSTGRES_PORT=5444
IAM_POSTGRES_USER=iam_user
IAM_POSTGRES_PASSWORD=iam_password
IAM_POSTGRES_DB=iam
IAM_POSTGRES_SSL_MODE=disable
IAM_MIGRATION_DIRECTORY=migrations

# Redis
IAM_REDIS_HOST=redis-iam
IAM_REDIS_PORT=6333
IAM_EXTERNAL_REDIS_PORT=6333
IAM_REDIS_CONNECTION_TIMEOUT=10s
IAM_REDIS_MAX_IDLE=10
IAM_REDIS_IDLE_TIMEOUT=240s

# Сессии
IAM_SESSION_TTL=24h

# JWT настройки
IAM_JWT_ACCESS_TOKEN_SECRET=very-long-and-secure-secret-key-for-access-tokens
IAM_JWT_REFRESH_TOKEN_SECRET=very-long-and-secure-secret-key-for-refresh-tokens
IAM_JWT_ACCESS_TOKEN_TTL=15m
IAM_JWT_REFRESH_TOKEN_TTL=24h

# Security
IAM_RATE_LIMIT_REQUESTS=5
IAM_RATE_LIMIT_WINDOW=1m

# Performance
IAM_DB_MAX_CONNECTIONS=25
IAM_DB_MAX_IDLE_CONNECTIONS=5
IAM_DB_CONNECTION_TIMEOUT=30s
IAM_REDIS_MAX_ACTIVE=100
IAM_REDIS_READ_TIMEOUT=10s
IAM_REDIS_WRITE_TIMEOUT=10s

# Monitoring

# Dev mode
IAM_DEV_MODE=true
IAM_AUTO_CREATE_DB=true
IAM_DEBUG_MODE=false

# -----------------------------------------
# INVENTORY СЕРВИС
# -----------------------------------------

# gRPC настройки
INVENTORY_GRPC_HOST=0.0.0.0
INVENTORY_GRPC_PORT=50051

# gRPC клиенты
INVENTORY_IAM_CLIENT_GRPC_HOST=iam-service
INVENTORY_IAM_CLIENT_GRPC_PORT=${IAM_GRPC_HOST}

# Логгер
INVENTORY_LOGGER_LEVEL=info
INVENTORY_LOGGER_AS_JSON=true

# MongoDB
INVENTORY_MONGO_IMAGE_NAME=mongo:7.0.5
INVENTORY_EXTERNAL_MONGO_PORT=27017
INVENTORY_MONGO_HOST=mongo-inventory
INVENTORY_MONGO_PORT=27017
INVENTORY_MONGO_INITDB_DATABASE=inventory-service
INVENTORY_MONGO_AUTH_DB=admin
INVENTORY_MONGO_INITDB_ROOT_USERNAME=inventory-service-user
INVENTORY_MONGO_INITDB_ROOT_PASSWORD=inventory-service-password

# -----------------------------------------
# PAYMENT СЕРВИС
# -----------------------------------------

# gRPC настройки
PAYMENT_GRPC_HOST=0.0.0.0
PAYMENT_GRPC_PORT=50052

# HTTP настройки
PAYMENT_HTTP_HOST=${PAYMENT_GRPC_HOST}
PAYMENT_HTTP_PORT=8081

# Логгер
PAYMENT_LOGGER_LEVEL=info
PAYMENT_LOGGER_AS_JSON=true

# -----------------------------------------
# ORDER СЕРВИС
# -----------------------------------------

# HTTP настройки
ORDER_HTTP_HOST=0.0.0.0
ORDER_HTTP_PORT=8080

# gRPC настройки клиента Inventory
ORDER_INVENTORY_CLIENT_GRPC_HOST=inventory-service
ORDER_INVENTORY_CLIENT_GRPC_PORT=${INVENTORY_GRPC_PORT}

# gRPC настройки клиента Payment
ORDER_PAYMENT_CLIENT_GRPC_HOST=payment-service
ORDER_PAYMENT_CLIENT_GRPC_PORT=${PAYMENT_GRPC_PORT}

# gRPC настройки клиента Iam
ORDER_IAM_CLIENT_GRPC_HOST=iam-service
ORDER_IAM_CLIENT_GRPC_PORT=${IAM_GRPC_HOST}

# Логгер
ORDER_LOGGER_LEVEL=info
ORDER_LOGGER_AS_JSON=true

# PostgreSQL
ORDER_POSTGRES_IMAGE_NAME=postgres:17.0-alpine3.20
ORDER_EXTERNAL_POSTGRES_PORT=5432
ORDER_POSTGRES_HOST=postgres-order
ORDER_POSTGRES_PORT=5432
ORDER_POSTGRES_SSLMODE=disable
ORDER_POSTGRES_INITDB_DATABASE=order-service
ORDER_POSTGRES_USER=order-service-user
ORDER_POSTGRES_PASSWORD=order-service-password
ORDER_MIGRATIONS_DIR=migrations

# Kafka настройки
ORDER_KAFKA_BROKERS=kafka:${CORE_KAFKA_INTERNAL_PORT}
ORDER_PRODUCER_TOPIC_NAME=order.paid
ORDER_CONSUMER_TOPIC_NAME=ship.assembled
ORDER_CONSUMER_GROUP_ID=order-service

# -----------------------------------------
# ASSEMBLY СЕРВИС
# -----------------------------------------

# Логгер
ASSEMBLY_LOGGER_LEVEL=info
ASSEMBLY_LOGGER_AS_JSON=true

# Kafka настройки
ASSEMBLY_KAFKA_BROKERS=kafka:${CORE_KAFKA_INTERNAL_PORT}
ASSEMBLY_CONSUMER_TOPIC_NAME=order.paid
ASSEMBLY_CONSUMER_GROUP_ID=assembly-service
ASSEMBLY_PRODUCER_TOPIC_NAME=ship.assembled

# -----------------------------------------
# NOTIFICATION СЕРВИС
# -----------------------------------------

# Логгер
NOTIFICATION_LOGGER_LEVEL=info
NOTIFICATION_LOGGER_AS_JSON=true

# Kafka настройки
NOTIFICATION_KAFKA_BROKERS=kafka:${CORE_KAFKA_INTERNAL_PORT}
NOTIFICATION_CONSUMER_ORDER_PAID_TOPIC_NAME=order.paid
NOTIFICATION_CONSUMER_ORDER_PAID_GROUP_ID=notification-service
NOTIFICATION_CONSUMER_SHIP_ASSEMBLED_TOPIC_NAME=ship.assembled
NOTIFICATION_CONSUMER_SHIP_ASSEMBLED_GROUP_ID=notification-service

# Telegram настройки
NOTIFICATION_TELEGRAM_BOT_TOKEN=token
NOTIFICATION_TELEGRAM_SKIP_API_CHECK=false

# gRPC настройки клиента Iam
NOTIFICATION_IAM_CLIENT_GRPC_HOST=iam-service
NOTIFICATION_IAM_CLIENT_GRPC_PORT=${IAM_GRPC_PORT}